# Copyright (C) 2022 Broadcom. All rights reserved.
# The term "Broadcom" refers solely to the Broadcom Inc. corporate affiliate
# that owns the software below.
# This work is licensed under the OpenAFC Project License, a copy of which is
# included with this software program.

global:
  scrape_interval: 5s
  scrape_timeout: 2s
  evaluation_interval: 15s  # Interval for recording rules

scrape_configs:
  - job_name: prometheus
    static_configs:
      - targets: [localhost:9090]
  - job_name: dummy
    file_sd_configs:
      # List is populated in entrypoint.sh with $PROMETHEUS_TARGETS
      - files: [TARGETS_REPLACEME]
    metric_relabel_configs:
      - source_labels: [name]
        regex: "(.*?)_(rat_server|als_siphon|uls_downloader|bulk_postgres|\
          als_kafka|cert_db|rcache_tool|[^_]+)_[0-9]+"
        replacement: "$1"
        target_label: project
      - source_labels: [name]
        regex: "(.*?)_(rat_server|als_siphon|uls_downloader|bulk_postgres|\
          als_kafka|cert_db|rcache_tool|[^_]+)_[0-9]+"
        replacement: "$2"
        target_label: service
      - regex: image
        action: labeldrop
      - regex: container_label_.*
        action: labeldrop
